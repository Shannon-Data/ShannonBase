# Tests for the SECONDARY_ENGINE table option.
# Most DDLs are allowed on tables with SECONDARY_ENGINE when
# the corresponding SECONDARY_ENGINE plugin is not installed.
# Following tests are with SECONDARY_ENGINE plugin that doesn't exist.

# USED FOR rapid params.
create database sh_params;
use sh_params;
--disable_warnings

CREATE TABLE t1 (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_name VARCHAR(50) NOT NULL,
    account_status ENUM('active', 'inactive', 'suspended') NOT NULL DEFAULT 'active'
) ENGINE=InnoDB SECONDARY_ENGINE=RAPID;

# insert example rows
INSERT INTO t1 (user_name, account_status) VALUES
('张三', 'active'),
('李四', 'inactive'),
('bob', 'inactive'),
('grace', 'active'),
('王五', 'suspended');

SHOW VARIABLES LIKE "%rapid%";
--ERROR 1229
SET rapid_rapid_async_column_threshold=11;

SET GLOBAL rapid_rapid_async_column_threshold=11;
SHOW VARIABLES LIKE "%rapid%";

ALTER TABLE  t1 secondary_load;
--ERROR 3877
SET GLOBAL rapid_rapid_async_column_threshold=10;
ALTER TABLE  t1 secondary_unload;
SET GLOBAL rapid_rapid_async_column_threshold=10;
SHOW VARIABLES LIKE "%rapid%";

--enable_warnings
DROP DATABASE sh_params;
