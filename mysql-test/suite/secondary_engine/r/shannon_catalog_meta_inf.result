#
# Test system meta inf related to secondary engine.
#
CREATE DATABASE TEST_CATALOG;
USE TEST_CATALOG;
SELECT @@use_secondary_engine;
@@use_secondary_engine
ON
CREATE TABLE tt1 (SCORE INT, NAME CHAR(10), ID INT, GENDER CHAR(1), PRIMARY KEY(ID, SCORE)) SECONDARY_ENGINE=RAPID;
INSERT INTO tt1 VALUES(10, 'n1', 1, 'm'), (20, 'n2', 2, 'f'), (30, 'n3', 3, 'm');
create table tt9 (score int, name char(10), id int, gender char(1), index score_idx(score), primary key(id, score)) SECONDARY_ENGINE=RAPID;
insert into tt9 values(1, 'n1', 1, 'm'), (2, 'n2', 2, 'f'), (3, 'n3', 3, 'm');
ALTER TABLE tt1 SECONDARY_LOAD;
ALTER TABLE tt9 SECONDARY_LOAD;
SELECT * FROM performance_schema.rpd_columns;
TABLE_ID	COLUMN_ID	NDV	ENCODING	DATA_PLACEMENT_INDEX	DICT_SIZE_BTYES
143	0	0	N/A	0	0
143	1	0	N/A	0	3
143	2	0	N/A	0	0
143	3	0	N/A	0	2
144	0	0	N/A	0	0
144	1	0	N/A	0	3
144	2	0	N/A	0	0
144	3	0	N/A	0	2
SELECT * FROM performance_schema.rpd_column_id;
ID	TABLE_ID	COLUMN_NAME
0	143	SCORE
1	143	NAME
2	143	ID
3	143	GENDER
0	144	score
1	144	name
2	144	id
3	144	gender
SELECT * FROM performance_schema.rpd_table_id;
ID	NAME	SCHEMA_NAME	TABLE_NAME
143	TEST_CATALOG\tt1	TEST_CATALOG	tt1
144	TEST_CATALOG\tt9	TEST_CATALOG	tt9
SELECT * FROM performance_schema.rpd_tables;
ID	SNAPSHOT_SCN	PERSISTED_SCN	POOL_TYPE	DATA_PLACEMENT_TYPE	T_NROWS	LOAD_STATUS	LOAD_PROGRESS	SIZE_BYTES	TRANSFORMATION_BYTES	E_NROWS	QUERY_COUNT	LAST_QUERIED	LOAD_START_TIMESTAMP	LOAD_END_TIMESTAMP	RECOVERY_SOURCE	RECOVERY_START_TIMESTAMP	RECOVERY_END_TIMESTAMP
143	0	0	0	0	0	0	0	0	0	0	0	0000-00-00 00:00:00	0000-00-00 00:00:00	0000-00-00 00:00:00	InnoDB/ObjectStorage	0000-00-00 00:00:00	0000-00-00 00:00:00
143	0	0	0	0	0	0	0	0	0	0	0	0000-00-00 00:00:00	0000-00-00 00:00:00	0000-00-00 00:00:00	InnoDB/ObjectStorage	0000-00-00 00:00:00	0000-00-00 00:00:00
143	0	0	0	0	0	0	0	0	0	0	0	0000-00-00 00:00:00	0000-00-00 00:00:00	0000-00-00 00:00:00	InnoDB/ObjectStorage	0000-00-00 00:00:00	0000-00-00 00:00:00
143	0	0	0	0	0	0	0	0	0	0	0	0000-00-00 00:00:00	0000-00-00 00:00:00	0000-00-00 00:00:00	InnoDB/ObjectStorage	0000-00-00 00:00:00	0000-00-00 00:00:00
144	0	0	0	0	0	0	0	0	0	0	0	0000-00-00 00:00:00	0000-00-00 00:00:00	0000-00-00 00:00:00	InnoDB/ObjectStorage	0000-00-00 00:00:00	0000-00-00 00:00:00
144	0	0	0	0	0	0	0	0	0	0	0	0000-00-00 00:00:00	0000-00-00 00:00:00	0000-00-00 00:00:00	InnoDB/ObjectStorage	0000-00-00 00:00:00	0000-00-00 00:00:00
144	0	0	0	0	0	0	0	0	0	0	0	0000-00-00 00:00:00	0000-00-00 00:00:00	0000-00-00 00:00:00	InnoDB/ObjectStorage	0000-00-00 00:00:00	0000-00-00 00:00:00
144	0	0	0	0	0	0	0	0	0	0	0	0000-00-00 00:00:00	0000-00-00 00:00:00	0000-00-00 00:00:00	InnoDB/ObjectStorage	0000-00-00 00:00:00	0000-00-00 00:00:00
SELECT * FROM performance_schema.rpd_preload_stats;
TABLE_SCHEMA	TABLE_NAME	COLUMN_NAME	AVG_BYTE_WIDTH_INC_NULL
TEST_CATALOG	tt1	SCORE	0
TEST_CATALOG	tt1	NAME	0
TEST_CATALOG	tt1	ID	0
TEST_CATALOG	tt1	GENDER	0
TEST_CATALOG	tt9	score	0
TEST_CATALOG	tt9	name	0
TEST_CATALOG	tt9	id	0
TEST_CATALOG	tt9	gender	0
SET @@use_secondary_engine = "FORCED";
SELECT * FROM tt1;
SCORE	NAME	ID	GENDER
10	n1	1	m
20	n2	2	f
30	n3	3	m
SELECT * FROM tt9;
score	name	id	gender
1	n1	1	m
2	n2	2	f
3	n3	3	m
ALTER TABLE tt9 SECONDARY_UNLOAD;
ALTER TABLE tt1 SECONDARY_UNLOAD;
SET @@use_secondary_engine = "ON";
SELECT * FROM performance_schema.rpd_columns;
TABLE_ID	COLUMN_ID	NDV	ENCODING	DATA_PLACEMENT_INDEX	DICT_SIZE_BTYES
SELECT * FROM performance_schema.rpd_column_id;
ID	TABLE_ID	COLUMN_NAME
SELECT * FROM performance_schema.rpd_table_id;
ID	NAME	SCHEMA_NAME	TABLE_NAME
SELECT * FROM performance_schema.rpd_tables;
ID	SNAPSHOT_SCN	PERSISTED_SCN	POOL_TYPE	DATA_PLACEMENT_TYPE	T_NROWS	LOAD_STATUS	LOAD_PROGRESS	SIZE_BYTES	TRANSFORMATION_BYTES	E_NROWS	QUERY_COUNT	LAST_QUERIED	LOAD_START_TIMESTAMP	LOAD_END_TIMESTAMP	RECOVERY_SOURCE	RECOVERY_START_TIMESTAMP	RECOVERY_END_TIMESTAMP
SELECT * FROM performance_schema.rpd_preload_stats;
TABLE_SCHEMA	TABLE_NAME	COLUMN_NAME	AVG_BYTE_WIDTH_INC_NULL
DROP DATABASE TEST_CATALOG;
