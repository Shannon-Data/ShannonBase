create database test_partition;
alter database test_partition CHARACTER SET ascii COLLATE ascii_bin;
use test_partition;
set global rapid_parallel_part_load_threshold =2;
CREATE TABLE LINEITEM ( L_ORDERKEY    BIGINT NOT NULL,
L_PARTKEY     INTEGER NOT NULL,
L_SUPPKEY     INTEGER NOT NULL,
L_LINENUMBER  INTEGER NOT NULL,
L_QUANTITY    DECIMAL(15,2) NOT NULL,
L_EXTENDEDPRICE  DECIMAL(15,2) NOT NULL,
L_DISCOUNT    DECIMAL(15,2) NOT NULL,
L_TAX         DECIMAL(15,2) NOT NULL,
L_RETURNFLAG  CHAR(1) NOT NULL,
L_LINESTATUS  CHAR(1) NOT NULL,
L_SHIPDATE    DATE NOT NULL,
L_COMMITDATE  DATE NOT NULL,
L_RECEIPTDATE DATE NOT NULL,
L_SHIPINSTRUCT CHAR(25) NOT NULL,
L_SHIPMODE     CHAR(10) NOT NULL,
L_COMMENT      VARCHAR(44) NOT NULL,
PRIMARY KEY (L_ORDERKEY, L_LINENUMBER))
PARTITION BY KEY()
PARTITIONS 11;
alter table LINEITEM secondary_engine NULL;
alter table LINEITEM change L_RETURNFLAG L_RETURNFLAG CHAR(1) NOT NULL COMMENT 'RAPID_COLUMN=ENCODING=SORTED';
alter table LINEITEM change L_LINESTATUS L_LINESTATUS CHAR(1) NOT NULL COMMENT 'RAPID_COLUMN=ENCODING=SORTED';
alter table LINEITEM change L_SHIPINSTRUCT L_SHIPINSTRUCT CHAR(25) NOT NULL COMMENT 'RAPID_COLUMN=ENCODING=SORTED';
alter table LINEITEM change L_COMMENT L_COMMENT VARCHAR(44) NOT NULL COMMENT 'RAPID_COLUMN=ENCODING=SORTED';
alter table LINEITEM change L_SHIPMODE L_SHIPMODE CHAR(10) NOT NULL COMMENT 'RAPID_COLUMN=ENCODING=SORTED';
alter table LINEITEM change L_ORDERKEY L_ORDERKEY BIGINT NOT NULL COMMENT 'RAPID_COLUMN=DATA_PLACEMENT_KEY=1';
set use_secondary_engine=forced;
alter table LINEITEM secondary_engine RAPID;
alter table LINEITEM secondary_load;
select * from LINEITEM order by L_ORDERKEY, L_PARTKEY;
L_ORDERKEY	L_PARTKEY	L_SUPPKEY	L_LINENUMBER	L_QUANTITY	L_EXTENDEDPRICE	L_DISCOUNT	L_TAX	L_RETURNFLAG	L_LINESTATUS	L_SHIPDATE	L_COMMITDATE	L_RECEIPTDATE	L_SHIPINSTRUCT	L_SHIPMODE	L_COMMENT
23999974	311819	31820	4	22.00	40277.60	0.08	0.01	N	O	1997-03-25	1997-04-24	1997-03-28	COLLECT COD	REG AIR	uickly ironic pains. bli
23999974	737406	7461	5	2.00	2886.74	0.03	0.07	N	O	1997-04-25	1997-05-31	1997-05-21	NONE	REG AIR	nding accounts. ironic, final
23999974	770178	30217	6	48.00	59910.72	0.02	0.08	N	O	1997-03-15	1997-05-26	1997-03-26	TAKE BACK RETURN	FOB	fy packages nag evenly
23999975	350648	30649	3	18.00	30575.34	0.08	0.01	N	O	1996-10-07	1996-08-22	1996-10-19	DELIVER IN PERSON	TRUCK	ully pending dependencies hagg
23999975	353843	3852	1	1.00	1896.83	0.05	0.01	N	O	1996-08-03	1996-09-14	1996-08-15	TAKE BACK RETURN	RAIL	pending instructions affix qu
23999975	625094	15140	2	23.00	23438.38	0.05	0.06	N	O	1996-10-23	1996-09-11	1996-11-12	DELIVER IN PERSON	AIR	ly regular realms after the
24000000	277642	37643	3	20.00	32392.60	0.01	0.02	N	O	1996-05-14	1996-06-11	1996-06-04	TAKE BACK RETURN	REG AIR	s. blithely regular instructi
24000000	651246	21263	1	5.00	5986.05	0.06	0.05	N	O	1996-06-11	1996-05-16	1996-06-22	NONE	TRUCK	nts use. ir
24000000	677354	17387	2	30.00	39939.60	0.00	0.01	N	O	1996-04-21	1996-06-08	1996-05-08	TAKE BACK RETURN	REG AIR	le? blithely unusual deposits above
24000000	712607	2625	4	7.00	11336.99	0.09	0.00	N	O	1996-07-16	1996-06-18	1996-08-04	COLLECT COD	SHIP	ckly express requests. even, pendin
alter table LINEITEM secondary_unload;
alter table LINEITEM secondary_load PARTITION(p0, p1, p10);
alter table LINEITEM secondary_unload;
alter table LINEITEM secondary_load PARTITION(p0, p1, p10);
alter table LINEITEM secondary_unload PARTITION(p0, p10, p1);
alter table LINEITEM secondary_load PARTITION(p0, p1, p10);
alter table LINEITEM secondary_unload PARTITION(p0, p10);
alter table LINEITEM secondary_unload;
ERROR HY000: Secondary engine operation failed. test_partition.LINEITEM table is not loaded into rapid yet.
drop table LINEITEM;
set global rapid_parallel_part_load_threshold =12;
CREATE TABLE LINEITEM1 ( L_ORDERKEY    BIGINT NOT NULL,
L_PARTKEY     INTEGER NOT NULL,
L_SUPPKEY     INTEGER NOT NULL,
L_LINENUMBER  INTEGER NOT NULL,
L_QUANTITY    DECIMAL(15,2) NOT NULL,
L_EXTENDEDPRICE  DECIMAL(15,2) NOT NULL,
L_DISCOUNT    DECIMAL(15,2) NOT NULL,
L_TAX         DECIMAL(15,2) NOT NULL,
L_RETURNFLAG  CHAR(1) NOT NULL,
L_LINESTATUS  CHAR(1) NOT NULL,
L_SHIPDATE    DATE NOT NULL,
L_COMMITDATE  DATE NOT NULL,
L_RECEIPTDATE DATE NOT NULL,
L_SHIPINSTRUCT CHAR(25) NOT NULL,
L_SHIPMODE     CHAR(10) NOT NULL,
L_COMMENT      VARCHAR(44) NOT NULL,
PRIMARY KEY (L_ORDERKEY, L_LINENUMBER))
PARTITION BY KEY()
PARTITIONS 10;
alter table LINEITEM1 secondary_engine NULL;
alter table LINEITEM1 change L_RETURNFLAG L_RETURNFLAG CHAR(1) NOT NULL COMMENT 'RAPID_COLUMN=ENCODING=SORTED';
alter table LINEITEM1 change L_LINESTATUS L_LINESTATUS CHAR(1) NOT NULL COMMENT 'RAPID_COLUMN=ENCODING=SORTED';
alter table LINEITEM1 change L_SHIPINSTRUCT L_SHIPINSTRUCT CHAR(25) NOT NULL COMMENT 'RAPID_COLUMN=ENCODING=SORTED';
alter table LINEITEM1 change L_COMMENT L_COMMENT VARCHAR(44) NOT NULL COMMENT 'RAPID_COLUMN=ENCODING=SORTED';
alter table LINEITEM1 change L_SHIPMODE L_SHIPMODE CHAR(10) NOT NULL COMMENT 'RAPID_COLUMN=ENCODING=SORTED';
alter table LINEITEM1 change L_ORDERKEY L_ORDERKEY BIGINT NOT NULL COMMENT 'RAPID_COLUMN=DATA_PLACEMENT_KEY=1';
alter table LINEITEM1 secondary_engine RAPID;
alter table LINEITEM1 secondary_load;
explain select * from LINEITEM1 order by L_ORDERKEY, L_PARTKEY;
id	select_type	table	partitions	type	possible_keys	key	key_len	ref	rows	filtered	Extra
1	SIMPLE	LINEITEM1	p0,p1,p2,p3,p4,p5,p6,p7,p8,p9	ALL	NULL	NULL	NULL	NULL	0	0.00	Using filesort; Using secondary engine Rapid
Warnings:
Note	1003	/* select#1 */ select `test_partition`.`LINEITEM1`.`L_ORDERKEY` AS `L_ORDERKEY`,`test_partition`.`LINEITEM1`.`L_PARTKEY` AS `L_PARTKEY`,`test_partition`.`LINEITEM1`.`L_SUPPKEY` AS `L_SUPPKEY`,`test_partition`.`LINEITEM1`.`L_LINENUMBER` AS `L_LINENUMBER`,`test_partition`.`LINEITEM1`.`L_QUANTITY` AS `L_QUANTITY`,`test_partition`.`LINEITEM1`.`L_EXTENDEDPRICE` AS `L_EXTENDEDPRICE`,`test_partition`.`LINEITEM1`.`L_DISCOUNT` AS `L_DISCOUNT`,`test_partition`.`LINEITEM1`.`L_TAX` AS `L_TAX`,`test_partition`.`LINEITEM1`.`L_RETURNFLAG` AS `L_RETURNFLAG`,`test_partition`.`LINEITEM1`.`L_LINESTATUS` AS `L_LINESTATUS`,`test_partition`.`LINEITEM1`.`L_SHIPDATE` AS `L_SHIPDATE`,`test_partition`.`LINEITEM1`.`L_COMMITDATE` AS `L_COMMITDATE`,`test_partition`.`LINEITEM1`.`L_RECEIPTDATE` AS `L_RECEIPTDATE`,`test_partition`.`LINEITEM1`.`L_SHIPINSTRUCT` AS `L_SHIPINSTRUCT`,`test_partition`.`LINEITEM1`.`L_SHIPMODE` AS `L_SHIPMODE`,`test_partition`.`LINEITEM1`.`L_COMMENT` AS `L_COMMENT` from `test_partition`.`LINEITEM1` order by `test_partition`.`LINEITEM1`.`L_ORDERKEY`,`test_partition`.`LINEITEM1`.`L_PARTKEY`
alter table LINEITEM1 secondary_unload;
SET SESSION optimizer_switch='hypergraph_optimizer=on';
Warnings:
Warning	1287	The hypergraph optimizer is highly experimental and is meant for testing only. Do not enable it unless you are a MySQL developer.
set use_secondary_engine=1;
set secondary_engine_cost_threshold =1.5;
set global rapid_use_dynamic_offload=1;
SET optimizer_trace = 'enabled=on';
SET SESSION optimizer_switch='hypergraph_optimizer=on';
drop database test_partition;
